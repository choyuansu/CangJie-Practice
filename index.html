<head>
    <meta charset="UTF-8">
    <title>自然大新倉頡常用詞練習</title>
    <meta name="description" content="自然大新倉頡常用詞練習" />
    <meta name="author" content="choyuansu" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="favicon.ico" />
    <link rel="manifest" href="js13kpwa.webmanifest" />
    <script src="./newcj.js"></script>
    <script src="./common_terms.js"></script>
</head>

<body>
    <h1>自然大新倉頡常用詞練習</h1>
    <h2>民國110年新聞媒體詞頻表</h2>
    <button onclick="toggleOptionsDisplay()">選項</button>
    <br>
    <br>
    <div id="options" style="display: none;">
        <input type="checkbox" id="showHint" name="showHint" value="showHint" onchange="showHint()">
        <label for="showHint">Show hint</label><br>
        <input type="checkbox" id="shuffle" name="shuffle" value="shuffle" onchange="updatePermutation()">
        <label for="shuffle">Shuffle</label><br>
        <input type="number" id="begin" name="begin" min="1" max="557086" value="1" onchange="updatePermutation()">～
        <input type="number" id="end" name="end" min="1" max="557086" value="557086" onchange="updatePermutation()">
    </div>
    <hr>
    <br>
    <input id="input" type="text" oninput="checkAnswer(this.value)" />
    <br>
    <br>
    <div id="prompt"></div>
    <div id="hint"></div>
</body>
<script>
    var termIndex = 0;
    let permutation = Array.from({ length: 557086 }, (_, i) => i);

    function updatePrompt() {
        const begin = parseInt(document.getElementById("begin").value);
        document.getElementById("prompt").innerText = (termIndex + 1).toString() + '. ' + commonTerms[permutation[termIndex] + begin - 1];
    }

    function updateHint() {
        hintHtml = "";
        const begin = parseInt(document.getElementById("begin").value);
        for (var char of commonTerms[permutation[termIndex] + begin - 1]) {
            if (char in newcjTable) {
                resultHtml = `<b>${char}</b><hr>${newcjTable[char].join("<br>")}`;
                hintHtml += '<div class="result">' + resultHtml + "</div>"
            }
        }
        document.getElementById("hint").innerHTML = hintHtml;
    }

    function checkAnswer(answer) {
        if (answer == document.getElementById("prompt").innerText.split(" ")[1]) {
            if (termIndex == document.getElementById("end").value) {
                document.getElementById("prompt").innerText = "恭喜完成所有題目！";
                document.getElementById("hint").innerHTML = "";
                return;
            }
            updatePrompt();
            updateHint();
            termIndex++;
            document.getElementById("input").value = "";
        }
    }

    function toggleOptionsDisplay() {
        const options = document.getElementById("options");
        options.style.display = options.style.display === "none" ? "block" : "none";
    }

    function shuffle() {
        console.log("shuffle");
        if (document.getElementById("shuffle").checked) {
            permutation.sort(() => Math.random() - 0.5);
        }
        else {
            const begin = parseInt(document.getElementById("begin").value);
            const end = document.getElementById("end").value;
            permutation = Array.from({ length: end - begin + 1 }, (_, i) => i);
            console.log("begin", begin);
            console.log("end", end);
        }
        termIndex = 0;
        updatePrompt();
        updateHint();
        termIndex++;
    }

    function updatePermutation() {
        const begin = parseInt(document.getElementById("begin").value);
        const end = document.getElementById("end").value;
        permutation = Array.from({ length: end - begin + 1 }, (_, i) => i);
        if (document.getElementById("shuffle").checked) {
            permutation.sort(() => Math.random() - 0.5);
        }
        termIndex = 0;
        updatePrompt();
        updateHint();
        termIndex++;
    }

    function showHint() {
        const hint = document.getElementById("hint");
        hint.style.display = hint.style.display === "none" ? "block" : "none";
    }

    window.onload = () => {
        updatePrompt();
        updateHint();
        termIndex++;
        document.getElementById("input").value = "";
        document.getElementById("hint").style.display = "block";
        document.getElementById("showHint").checked = "true";
        document.getElementById("shuffle").checked = "";
    };
</script>
<style>
    html,
    body {
        max-width: 100%;
        height: 100%;
        text-align: center;
        overflow-x: hidden;
        margin: 0;
    }

    h1 {
        margin: 1em;
    }

    #input {
        font-size: 1.5em;
        text-align: center;
    }

    #results {
        text-align: left;
    }

    .row {
        vertical-align: middle;
    }

    #prompt {
        font-size: 2em;
    }

    .result {
        width: 4em;
        border: 2px black solid;
        margin: .5em;
        padding: .8em;
        border-radius: .5em;
        display: inline-block;
        vertical-align: top;
        text-align: left;
    }
</style>